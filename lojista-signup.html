<!doctype html>
<html lang="pt-br" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Cadastro de Lojista - MenuClick</title>
  <link rel="stylesheet" href="./css/styles.css"/>
  <link rel="stylesheet" href="./css/auth.css"/>
</head>
<body class="auth">
  <div class="authWrap">
    <div class="authCard">
      <section class="authHero">
        <div class="brandRow">
          <div class="logoDot">游낅</div>
          <strong>MenuClick Parceiros</strong>
        </div>
        <h2>Comece a vender</h2>
        <p>Crie sua conta de parceiro e deixe sua loja pronta para aparecer no app.</p>
        <ul>
          <li>Cat치logo f치cil (produtos e categorias)</li>
          <li>Pedidos em tempo real no painel</li>
          <li>Suporte e onboarding</li>
        </ul>
        <p style="margin-top:14px; font-size:12px; color:var(--muted)">
          J치 칠 parceiro? <a href="login-lojista.html" style="text-decoration:underline; font-weight:650">Entrar</a>
        </p>
      </section>

      <section class="authPanel">
        <div class="topRow">
          <div>
            <h1>Cadastro de lojista</h1>
            <p class="sub">Preencha seus dados e os dados da loja.</p>
          </div>
          <button class="btnIcon" id="themeToggle" title="Tema" aria-label="Tema">游깿</button>
        </div>

        <div class="formGrid">
          <div class="field span2">
            <label>Nome do respons치vel</label>
            <input class="input" id="ownerName" placeholder="Seu nome" autocomplete="name"/>
          </div>

          <div class="field">
            <label>WhatsApp</label>
            <input class="input" id="ownerPhone" placeholder="(DD) 9xxxx-xxxx" inputmode="tel" autocomplete="tel"/>
          </div>

          <div class="field">
            <label>CNPJ</label>
            <input class="input" id="cnpj" placeholder="00.000.000/0000-00" inputmode="numeric"/>
          </div>

          <div class="field span2">
            <label>Nome da loja</label>
            <input class="input" id="storeName" placeholder="Ex: Pizzaria do Centro"/>
          </div>

          <div class="field">
            <label>Segmento</label>
            <select class="input" id="segment">
              <option value="restaurante">Restaurante</option>
              <option value="mercado">Mercado</option>
              <option value="sorveteria">Sorveteria</option>
              <option value="farmacia">Farm치cia</option>
              <option value="bebidas">Bebidas</option>
              <option value="petshop">Petshop</option>
              <option value="outros">Outros</option>
            </select>
          </div>

          <div class="field">
            <label>Cidade</label>
            <input class="input" id="cidade" placeholder="Ex: S칚o Paulo"/>
          </div>

          <div class="field">
            <label>Rua</label>
            <input class="input" id="rua" placeholder="Rua / Av."/>
          </div>

          <div class="field">
            <label>N칰mero</label>
            <input class="input" id="numero" placeholder="N췈" inputmode="numeric"/>
          </div>

          <div class="field">
            <label>Bairro</label>
            <input class="input" id="bairro" placeholder="Bairro"/>
          </div>

          <div class="field">
            <label>CEP</label>
            <input class="input" id="cep" placeholder="00000-000" inputmode="numeric"/>
          </div>

          <div class="field span2">
            <label>Complemento (opcional)</label>
            <input class="input" id="complemento" placeholder="Apto, bloco, refer칡ncia..."/>
          </div>

          <div class="field span2">
            <label>Categorias da loja (opcional)</label>
            <input class="input" id="storeCats" placeholder="Ex: Pizzas, Massas, Bebidas"/>
          </div>

          <div class="field span2">
            <label>Descri칞칚o curta (opcional)</label>
            <textarea class="input" id="storeDesc" rows="3" placeholder="Conte sobre sua loja..."></textarea>
          </div>

          <div class="field span2">
            <label>E-mail (login do parceiro)</label>
            <input class="input" id="email" placeholder="parceiro@loja.com" autocomplete="email"/>
          </div>

          <div class="field">
            <label>Senha</label>
            <input class="input" id="password" type="password" placeholder="Crie uma senha" autocomplete="new-password"/>
          </div>

          <div class="field">
            <label>Confirmar senha</label>
            <input class="input" id="password2" type="password" placeholder="Repita a senha" autocomplete="new-password"/>
          </div>

          <div class="field span2">
            <button class="btn btnAccent" id="btnCreate" style="width:100%">Criar conta e minha loja</button>
          </div>
        </div>

        <p class="smallNote">
          J치 tem conta? <a href="login-lojista.html" style="text-decoration:underline">Entrar</a>
        </p>
      </section>
    </div>
  </div>

  <script type="module">
    import { createOwnerAndStore } from "./js/owner.js";
    import { checkLoginStatus, isValidEmail, isValidPhoneBR } from "./js/auth.js";
    import { initThemeToggle } from "./js/theme.js";

    
    initThemeToggle();
checkLoginStatus(false);

    const btn = document.getElementById("btnCreate");
    const val = (id) => (document.getElementById(id).value || "").trim();
    const digits = (v) => String(v||"").replace(/\D/g,"");

    function isValidCnpj(v){
      const d = digits(v);
      return d.length === 14;
    }

    btn.onclick = async () => {
      const form = {
        ownerName: val("ownerName"),
        ownerPhone: val("ownerPhone"),
        cnpj: val("cnpj"),
        storeName: val("storeName"),
        segment: document.getElementById("segment").value,
        cidade: val("cidade"),
        rua: val("rua"),
        numero: val("numero"),
        bairro: val("bairro"),
        cep: val("cep"),
        complemento: val("complemento"),
        storeCats: val("storeCats"),
        storeDesc: val("storeDesc"),
        email: val("email").toLowerCase(),
        password: document.getElementById("password").value || "",
        password2: document.getElementById("password2").value || "",
      };

      if(!form.ownerName) return alert("Informe o nome do respons치vel.");
      if(!form.ownerPhone || !isValidPhoneBR(form.ownerPhone)) return alert("Informe um WhatsApp v치lido com DDD.");
      if(!form.cnpj || !isValidCnpj(form.cnpj)) return alert("Informe um CNPJ v치lido.");
      if(!form.storeName) return alert("Informe o nome da loja.");
      if(!form.cidade) return alert("Informe a cidade.");
      if(!form.rua || !form.numero || !form.bairro || !form.cep) return alert("Complete o endere칞o da loja (Rua, N칰mero, Bairro e CEP).");
      if(!isValidEmail(form.email)) return alert("Informe um e-mail v치lido.");
      if(form.password.length < 6) return alert("A senha precisa ter pelo menos 6 caracteres.");
      if(form.password !== form.password2) return alert("As senhas n칚o conferem.");

      btn.disabled = true;
      btn.textContent = "Criando...";

      try{
        await createOwnerAndStore({
          ...form,
          password: form.password
        });
        // redirect pelo checkLoginStatus
      }catch(e){
        console.error(e);
        alert("Erro ao criar conta: " + (e?.message || "tente novamente"));
        btn.disabled = false;
        btn.textContent = "Criar conta e minha loja";
      }
    };
  </script>
</body>
</html>
