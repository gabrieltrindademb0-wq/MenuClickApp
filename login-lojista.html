<!doctype html>
<html lang="pt-br" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Entrar (Parceiro) - MenuClick</title>
  <link rel="stylesheet" href="./css/styles.css"/>
  <link rel="stylesheet" href="./css/auth.css"/>
</head>
<body class="auth">
  <div class="authWrap">
    <div class="authCard">
      <section class="authHero">
        <div class="brandRow">
          <div class="logoDot">游낅</div>
          <strong>MenuClick</strong><span class="badge">Parceiro</span>
        </div>
        <h2>Bem-vindo de volta</h2>
        <p>Entre para gerenciar sua loja, produtos e pedidos.</p>
        <ul>
          <li>Use <b>e-mail</b> ou <b>WhatsApp</b> para entrar</li>
          <li>Recupera칞칚o de senha em 1 clique</li>
                  </ul>
      </section>

      <section class="authPanel">
        <div class="topRow">
          <div>
            <h1>Entrar</h1>
            <p class="sub">Acesse sua conta.</p>
          </div>
          <button class="btnIcon" id="themeToggle" title="Tema" aria-label="Tema">游깿</button>
        </div>
<div class="formGrid one">
          <div class="field">
            <label>E-mail ou WhatsApp</label>
            <input class="input" id="identifier" placeholder="seu@email.com ou (DD) 9xxxx-xxxx" autocomplete="username"/>
          </div>

          <div class="field">
            <label>Senha</label>
            <input class="input" id="password" type="password" placeholder="Sua senha" autocomplete="current-password"/>
          </div>

          <div class="rowBetween">
            <button class="linkBtn" id="btnForgot" type="button">Esqueceu a senha?</button>
            <a href="lojista-signup.html" style="text-decoration:underline; font-weight:650">Cadastrar loja</a>
          </div>

          <button class="btn btnAccent" id="btnLogin" style="width:100%; margin-top:10px">Entrar</button>
        </div>

        <p class="smallNote">
          칄 cliente? <a href="login-cliente.html">Entrar como cliente</a>.</p>
      </section>
    </div>
  </div>

  <script type="module">
    import { loginUser, checkLoginStatus, resetPassword, isValidEmail, isValidPhoneBR, isLikelyEmail} from "./js/auth.js";
    import { initThemeToggle } from "./js/theme.js";

    
    initThemeToggle();
checkLoginStatus(false);

    function val(v){ return (v || "").trim(); }
      }catch(e){
        console.error(e);
        alert("N칚o foi poss칤vel entrar com Google. Verifique se o provedor Google est치 ativado no Firebase Auth.");
      }
    };

    document.getElementById("btnForgot").onclick = async () => {
      const id = val(document.getElementById("identifier").value).toLowerCase();
      if(!id){
        alert("Digite seu e-mail no campo acima para recuperar a senha.");
        return;
      }
      if(!isLikelyEmail(id)){
        alert("Para recuperar a senha, informe seu e-mail (n칚o WhatsApp).");
        return;
      }
      if(!isValidEmail(id)){
        alert("E-mail inv치lido.");
        return;
      }
      try{
        await resetPassword(id);
        alert("Enviamos um e-mail de recupera칞칚o. Verifique sua caixa de entrada e spam.");
      }catch(e){
        console.error(e);
        alert("N칚o foi poss칤vel enviar o e-mail de recupera칞칚o.");
      }
    };

    document.getElementById("btnLogin").onclick = async () => {
      const identifier = val(document.getElementById("identifier").value);
      const pass = document.getElementById("password").value || "";

      if(!identifier){ alert("Digite seu e-mail ou WhatsApp."); return; }
      if(isLikelyEmail(identifier)){
        if(!isValidEmail(identifier)) { alert("E-mail inv치lido."); return; }
      }else{
        if(!isValidPhoneBR(identifier)) { alert("WhatsApp inv치lido. Use DDD + n칰mero."); return; }
      }
      if(pass.length < 6){ alert("Senha inv치lida."); return; }

      try{
        await loginUser(identifier, pass);
      }catch(e){
        console.error(e);
        alert("Erro ao entrar. Verifique seus dados.");
      }
    };
  </script>
</body>
</html>
