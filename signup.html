<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Cadastro - Delivery</title>
  <link rel="stylesheet" href="./css/styles.css"/>
</head>
<body>
  <div class="container" style="max-width:400px; margin-top:40px">
    <div class="card">
      <h1 class="h1">Crie sua conta</h1>
      <p class="hint">Preencha seus dados para pedir.</p>

      <input class="input" type="text" id="name" placeholder="Nome Completo" required style="margin-bottom:10px"/>
      <input class="input" type="text" id="cpf" placeholder="CPF" required style="margin-bottom:10px"/>
      <input class="input" type="tel" id="phone" placeholder="Telefone/WhatsApp" required style="margin-bottom:10px"/>
      <textarea class="input" id="address" placeholder="Endereço completo (Rua, Nº, Bairro)" rows="3" style="margin-bottom:10px"></textarea>
      
      <hr/>
      
      <input class="input" type="email" id="email" placeholder="Seu E-mail" required style="margin-bottom:10px"/>
      <input class="input" type="password" id="password" placeholder="Senha segura" required style="margin-bottom:10px"/>

      <button class="btn btnAccent" id="btnSignup" style="width:100%">Cadastrar</button>
      
      <p class="hint" style="margin-top:15px; text-align:center">
        Já tem conta? <a href="login.html" style="text-decoration:underline">Entrar</a>
      </p>
    </div>
  </div>

  <script type="module">
    import { registerUser, checkLoginStatus } from "./js/auth.js";

    checkLoginStatus(false); // Verifica se já está logado

    document.getElementById("btnSignup").onclick = async () => {
      const name = document.getElementById("name").value;
      const cpf = document.getElementById("cpf").value;
      const phone = document.getElementById("phone").value;
      const address = document.getElementById("address").value;
      const email = document.getElementById("email").value;
      const pass = document.getElementById("password").value;

      if(!name || !cpf || !email || !pass) {
        alert("Preencha os campos obrigatórios!");
        return;
      }

      try {
        const btn = document.getElementById("btnSignup");
        btn.disabled = true;
        btn.innerText = "Criando...";

        // Cria usuário como 'customer' (cliente)
        await registerUser(email, pass, {
            name, cpf, phone, address, role: 'customer'
        });

        alert("Conta criada com sucesso!");
        // O checkLoginStatus vai redirecionar automaticamente
      } catch (error) {
        console.error(error);
        alert("Erro ao criar conta: " + error.message);
        document.getElementById("btnSignup").disabled = false;
        document.getElementById("btnSignup").innerText = "Cadastrar";
      }
    };
  </script>
</body>
</html>