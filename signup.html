<!doctype html>
<html lang="pt-br" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Criar conta - MenuClick</title>
  <link rel="stylesheet" href="./css/styles.css"/>
  <link rel="stylesheet" href="./css/auth.css"/>
</head>
<body class="auth">
  <div class="authWrap">
    <div class="authCard">
      <section class="authHero">
        <div class="brandRow">
          <div class="logoDot">üî•</div>
          <strong>MenuClick</strong>
        </div>
        <h2>Crie sua conta</h2>
        <p>Pe√ßa em restaurantes, mercados, farm√°cias e muito mais ‚Äî tudo em um s√≥ lugar.</p>
        <ul>
          <li>Entrega r√°pida e acompanhamento do pedido</li>
          <li>Ofertas e combos direto na tela</li>
          <li>Suporte e seguran√ßa no pagamento</li>
        </ul>
      </section>

      <section class="authPanel">
        <div class="topRow">
          <div>
            <h1>Cadastro</h1>
            <p class="sub">Preencha seus dados para come√ßar.</p>
          </div>
          <button class="btnIcon" id="themeToggle" title="Tema" aria-label="Tema">üåô</button>
        </div>

        <button class="btnGoogle" id="btnGoogle">
          <span style="font-size:18px">G</span>
          Continuar com Google
        </button>

        <div class="divider">ou</div>

        <div class="formGrid">
          <div class="field span2">
            <label>Nome completo</label>
            <input class="input" id="name" placeholder="Seu nome" autocomplete="name"/>
          </div>

          <div class="field">
            <label>CPF</label>
            <input class="input" id="cpf" placeholder="000.000.000-00" inputmode="numeric"/>
          </div>

          <div class="field">
            <label>WhatsApp</label>
            <input class="input" id="phone" placeholder="(DD) 9xxxx-xxxx" inputmode="tel" autocomplete="tel"/>
          </div>

          <div class="field">
            <label>Rua</label>
            <input class="input" id="rua" placeholder="Rua / Av." autocomplete="address-line1"/>
          </div>

          <div class="field">
            <label>N√∫mero</label>
            <input class="input" id="numero" placeholder="N¬∫" inputmode="numeric"/>
          </div>

          <div class="field">
            <label>Bairro</label>
            <input class="input" id="bairro" placeholder="Bairro"/>
          </div>

          <div class="field">
            <label>CEP</label>
            <input class="input" id="cep" placeholder="00000-000" inputmode="numeric" autocomplete="postal-code"/>
          </div>

          <div class="field span2">
            <label>Complemento (opcional)</label>
            <input class="input" id="complemento" placeholder="Apto, bloco, refer√™ncia..."/>
          </div>

          <div class="field span2">
            <label>E-mail</label>
            <input class="input" id="email" placeholder="seu@email.com" autocomplete="email"/>
          </div>

          <div class="field">
            <label>Senha</label>
            <input class="input" id="password" type="password" placeholder="Crie uma senha" autocomplete="new-password"/>
          </div>

          <div class="field">
            <label>Confirmar senha</label>
            <input class="input" id="password2" type="password" placeholder="Repita a senha" autocomplete="new-password"/>
          </div>

          <div class="field span2">
            <button class="btn btnAccent" id="btnSignup" style="width:100%">Criar conta</button>
          </div>
        </div>

        <div class="rowBetween">
          <span style="color:var(--muted); font-size:12px">Ao continuar, voc√™ concorda com nossos termos.</span>
        </div>

        <p class="smallNote">
          J√° tem conta? <a href="login-cliente.html" style="text-decoration:underline">Entrar</a>
        </p>
      </section>
    </div>
  </div>

  <script type="module">
    import { registerUser, logoutTo, isValidEmail, isValidPhoneBR, loginWithGoogleCustomer } from "./js/auth.js";
    import { initThemeToggle } from "./js/theme.js";

    
    initThemeToggle();
    const btn = document.getElementById("btnSignup");

    function val(v){ return (v || "").trim(); }

    document.getElementById("btnGoogle").onclick = async () => {
      try{
        await loginWithGoogleCustomer();
      }catch(e){
        console.error(e);
        alert("N√£o foi poss√≠vel entrar com Google. Verifique se o provedor Google est√° ativado no Firebase Auth.");
      }
    };

    btn.onclick = async () => {
      const name = val(document.getElementById("name").value);
      const cpf = val(document.getElementById("cpf").value);
      const phone = val(document.getElementById("phone").value);

      const rua = val(document.getElementById("rua").value);
      const numero = val(document.getElementById("numero").value);
      const bairro = val(document.getElementById("bairro").value);
      const cep = val(document.getElementById("cep").value);
      const complemento = val(document.getElementById("complemento").value);

      const email = val(document.getElementById("email").value).toLowerCase();
      const pass = document.getElementById("password").value || "";
      const pass2 = document.getElementById("password2").value || "";

      if(!name){ alert("Informe seu nome."); return; }
      if(!cpf){ alert("Informe seu CPF."); return; }
      if(!phone || !isValidPhoneBR(phone)){ alert("Informe um WhatsApp v√°lido com DDD."); return; }

      if(!rua || !numero || !bairro || !cep){
        alert("Complete seu endere√ßo (Rua, N√∫mero, Bairro e CEP).");
        return;
      }

      if(!isValidEmail(email)){ alert("Informe um e-mail v√°lido."); return; }
      if(pass.length < 6){ alert("A senha precisa ter pelo menos 6 caracteres."); return; }
      if(pass !== pass2){ alert("As senhas n√£o conferem."); return; }

      btn.disabled = true;
      btn.textContent = "Criando...";

      try{
        await registerUser(email, pass, {
          name, cpf, phone,
          address: { rua, numero, bairro, cep, complemento },
          role: "customer"
        });
        // fluxo: Criar conta -> Entrar -> Menu
        await logoutTo("login-cliente.html?created=1");
      }catch(e){
        console.error(e);
        alert("Erro ao criar conta: " + (e?.message || "tente novamente"));
        btn.disabled = false;
        btn.textContent = "Criar conta";
      }
    };
  </script>
</body>
</html>
